{"ast":null,"code":"/**\n * vue-virtual\n *\n * Copyright (c) TanStack\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport { extends as _extends } from './_virtual/_rollupPluginBabelHelpers.mjs';\nimport { observeElementRect, observeElementOffset, elementScroll, observeWindowRect, observeWindowOffset, windowScroll, Virtualizer } from '@tanstack/virtual-core';\nexport * from '@tanstack/virtual-core';\nimport { computed, unref, shallowRef, watch, triggerRef, onScopeDispose } from 'vue';\nfunction useVirtualizerBase(options) {\n  var virtualizer = new Virtualizer(unref(options));\n  var state = shallowRef(virtualizer);\n  var cleanup = virtualizer._didMount();\n  watch(function () {\n    return unref(options).getScrollElement();\n  }, function (el) {\n    if (el) {\n      virtualizer._willUpdate();\n    }\n  }, {\n    immediate: true\n  });\n  watch(function () {\n    return unref(options);\n  }, function (options) {\n    virtualizer.setOptions(_extends({}, options, {\n      onChange: function onChange(instance, sync) {\n        triggerRef(state);\n        options.onChange == null || options.onChange(instance, sync);\n      }\n    }));\n    virtualizer._willUpdate();\n    triggerRef(state);\n  }, {\n    immediate: true\n  });\n  onScopeDispose(cleanup);\n  return state;\n}\nfunction useVirtualizer(options) {\n  return useVirtualizerBase(computed(function () {\n    return _extends({\n      observeElementRect: observeElementRect,\n      observeElementOffset: observeElementOffset,\n      scrollToFn: elementScroll\n    }, unref(options));\n  }));\n}\nfunction useWindowVirtualizer(options) {\n  return useVirtualizerBase(computed(function () {\n    return _extends({\n      getScrollElement: function getScrollElement() {\n        return typeof document !== 'undefined' ? window : null;\n      },\n      observeElementRect: observeWindowRect,\n      observeElementOffset: observeWindowOffset,\n      scrollToFn: windowScroll,\n      initialOffset: typeof document !== 'undefined' ? window.scrollY : undefined\n    }, unref(options));\n  }));\n}\nexport { useVirtualizer, useWindowVirtualizer };","map":{"version":3,"names":["useVirtualizerBase","options","virtualizer","Virtualizer","unref","state","shallowRef","cleanup","_didMount","watch","getScrollElement","el","_willUpdate","immediate","setOptions","_extends","onChange","instance","sync","triggerRef","onScopeDispose","useVirtualizer","computed","observeElementRect","observeElementOffset","scrollToFn","elementScroll","useWindowVirtualizer","document","window","observeWindowRect","observeWindowOffset","windowScroll","initialOffset","scrollY","undefined"],"sources":["../../src/index.ts"],"sourcesContent":["import {\n  elementScroll,\n  observeElementOffset,\n  observeElementRect,\n  observeWindowOffset,\n  observeWindowRect,\n  PartialKeys,\n  Virtualizer,\n  VirtualizerOptions,\n  windowScroll,\n} from '@tanstack/virtual-core'\nimport {\n  computed,\n  onScopeDispose,\n  Ref,\n  shallowRef,\n  triggerRef,\n  unref,\n  watch,\n} from 'vue'\nexport * from '@tanstack/virtual-core'\n\ntype MaybeRef<T> = T | Ref<T>\n\nfunction useVirtualizerBase<\n  TScrollElement extends Element | Window,\n  TItemElement extends Element,\n>(\n  options: MaybeRef<VirtualizerOptions<TScrollElement, TItemElement>>,\n): Ref<Virtualizer<TScrollElement, TItemElement>> {\n  const virtualizer = new Virtualizer(unref(options))\n  const state = shallowRef(virtualizer)\n\n  const cleanup = virtualizer._didMount()\n\n  watch(\n    () => unref(options).getScrollElement(),\n    (el) => {\n      if (el) {\n        virtualizer._willUpdate()\n      }\n    },\n    {\n      immediate: true,\n    },\n  )\n\n  watch(\n    () => unref(options),\n    (options) => {\n      virtualizer.setOptions({\n        ...options,\n        onChange: (instance, sync) => {\n          triggerRef(state)\n          options.onChange?.(instance, sync)\n        },\n      })\n\n      virtualizer._willUpdate()\n      triggerRef(state)\n    },\n    {\n      immediate: true,\n    },\n  )\n\n  onScopeDispose(cleanup)\n\n  return state\n}\n\nexport function useVirtualizer<\n  TScrollElement extends Element,\n  TItemElement extends Element,\n>(\n  options: MaybeRef<\n    PartialKeys<\n      VirtualizerOptions<TScrollElement, TItemElement>,\n      'observeElementRect' | 'observeElementOffset' | 'scrollToFn'\n    >\n  >,\n): Ref<Virtualizer<TScrollElement, TItemElement>> {\n  return useVirtualizerBase<TScrollElement, TItemElement>(\n    computed(() => ({\n      observeElementRect: observeElementRect,\n      observeElementOffset: observeElementOffset,\n      scrollToFn: elementScroll,\n      ...unref(options),\n    })),\n  )\n}\n\nexport function useWindowVirtualizer<TItemElement extends Element>(\n  options: MaybeRef<\n    PartialKeys<\n      VirtualizerOptions<Window, TItemElement>,\n      | 'observeElementRect'\n      | 'observeElementOffset'\n      | 'scrollToFn'\n      | 'getScrollElement'\n    >\n  >,\n): Ref<Virtualizer<Window, TItemElement>> {\n  return useVirtualizerBase<Window, TItemElement>(\n    computed(() => ({\n      getScrollElement: () => (typeof document !== 'undefined' ? window : null),\n      observeElementRect: observeWindowRect,\n      observeElementOffset: observeWindowOffset,\n      scrollToFn: windowScroll,\n      initialOffset:\n        typeof document !== 'undefined' ? window.scrollY : undefined,\n      ...unref(options),\n    })),\n  )\n}\n"],"mappings":";;;;;;;;;;;;;;AAwBA,SAASA,kBAAkBA,CAIzBC,OAAmE,EACnB;EAChD,IAAMC,WAAW,GAAG,IAAIC,WAAW,CAACC,KAAK,CAACH,OAAO,CAAC,CAAC;EACnD,IAAMI,KAAK,GAAGC,UAAU,CAACJ,WAAW,CAAC;EAErC,IAAMK,OAAO,GAAGL,WAAW,CAACM,SAAS,EAAE;EAEvCC,KAAK,CACH;IAAA,OAAML,KAAK,CAACH,OAAO,CAAC,CAACS,gBAAgB,EAAE;GACvC,YAACC,EAAE,EAAK;IACN,IAAIA,EAAE,EAAE;MACNT,WAAW,CAACU,WAAW,EAAE;IAC3B;EACF,CAAC,EACD;IACEC,SAAS,EAAE;EACb,CACF,CAAC;EAEDJ,KAAK,CACH;IAAA,OAAML,KAAK,CAACH,OAAO,CAAC;GACpB,YAACA,OAAO,EAAK;IACXC,WAAW,CAACY,UAAU,CAAAC,QAAA,KACjBd,OAAO;MACVe,QAAQ,EAAE,SAAAA,SAACC,QAAQ,EAAEC,IAAI,EAAK;QAC5BC,UAAU,CAACd,KAAK,CAAC;QACjBJ,OAAO,CAACe,QAAQ,YAAhBf,OAAO,CAACe,QAAQ,CAAGC,QAAQ,EAAEC,IAAI,CAAC;MACpC;IAAC,EACF,CAAC;IAEFhB,WAAW,CAACU,WAAW,EAAE;IACzBO,UAAU,CAACd,KAAK,CAAC;EACnB,CAAC,EACD;IACEQ,SAAS,EAAE;EACb,CACF,CAAC;EAEDO,cAAc,CAACb,OAAO,CAAC;EAEvB,OAAOF,KAAK;AACd;AAEO,SAASgB,cAAcA,CAI5BpB,OAKC,EAC+C;EAChD,OAAOD,kBAAkB,CACvBsB,QAAQ,CAAC;IAAA,OAAAP,QAAA;MACPQ,kBAAkB,EAAEA,kBAAkB;MACtCC,oBAAoB,EAAEA,oBAAoB;MAC1CC,UAAU,EAAEC;KACT,EAAAtB,KAAK,CAACH,OAAO,CAAC;EAAA,CACjB,CACJ,CAAC;AACH;AAEO,SAAS0B,oBAAoBA,CAClC1B,OAQC,EACuC;EACxC,OAAOD,kBAAkB,CACvBsB,QAAQ,CAAC;IAAA,OAAAP,QAAA;MACPL,gBAAgB,EAAE,SAAAA,iBAAA;QAAA,OAAO,OAAOkB,QAAQ,KAAK,WAAW,GAAGC,MAAM,GAAG,IAAI;OAAC;MACzEN,kBAAkB,EAAEO,iBAAiB;MACrCN,oBAAoB,EAAEO,mBAAmB;MACzCN,UAAU,EAAEO,YAAY;MACxBC,aAAa,EACX,OAAOL,QAAQ,KAAK,WAAW,GAAGC,MAAM,CAACK,OAAO,GAAGC;KAClD,EAAA/B,KAAK,CAACH,OAAO,CAAC;EAAA,CACjB,CACJ,CAAC;AACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}